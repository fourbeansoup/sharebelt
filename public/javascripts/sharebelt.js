// Generated by CoffeeScript 1.3.3
(function() {

  window.ShareBeltInjector = (function() {

    function ShareBeltInjector() {}

    window.loadResponse = function(data) {
      var belt;
      eval(data.script);
      belt = document.getElementById("sharebelt-wrapper");
      return belt.innerHTML = data.html;
    };

    ShareBeltInjector.prototype.buildUri = function(d) {
      var domain, location, referrer, site_id;
      domain = "sharebelt.com";
      referrer = this.stripProtocol(d.referrer);
      location = d.location.href;
      site_id = d.getElementById('sharebelt-wrapper').getAttribute('data-site');
      if (referrer) {
        return ("http://" + domain + "/sites/" + site_id + "/impressions?referrer=") + referrer + "&location=" + location + "&jsonp=loadResponse";
      } else {
        return "";
      }
    };

    ShareBeltInjector.prototype.injectScript = function(d) {
      var script;
      script = d.createElement("script");
      script.setAttribute("src", this.buildUri(d));
      return d.head.appendChild(script);
    };

    ShareBeltInjector.prototype.stripProtocol = function(referrer) {
      if (referrer.indexOf("https://") === 0) {
        return referrer.substring(8);
      }
      if (referrer.indexOf("http://" === 0)) {
        return referrer.substring(7);
      }
    };

    return ShareBeltInjector;

  })();

}).call(this);
